<section class="container">
    <form action="/inspectVehiculo/{{idLicensePlate}}" id="encuestaForm" method="post"
        enctype="application/x-www-form-urlencoded">
        <div class="fecha">
            <div class="input-fecha">
                {{#if (eq date undefined)}}
                <label>Fecha de inspección </label>
                <input type="date" name="date" id="date" value="">
                {{else}}
                <label>Fecha de inspección</label>
                <input type="date" name="date" id="date" value="{{date}}">
                {{/if}}
                
            </div>
        </div>
        <div class="accordion">

            {{#each specifications}}
            <div class="accordion-content">
                <div class="header">

                    <span class="title">{{idSpecifications}}. {{specification}}</span>
                    <i class="fa-solid fa-plus"></i>
                </div>
                <div class="description">
                    {{#each ../subspecifications}}
                    {{#if (eq specificationId ../idSpecifications)}}
                    <div class="preguntas">


                        <span class="title">{{idSubspecification}}. {{subSpecification}}</span>
                        <div class="row" name="{{idSubspecification}}">



                            <div class="col bueno">
                                <input type="radio" name="{{idSubspecification}}" id="{{idSubspecification}}bueno"
                                    autocomplete="off" value="1" {{#each ../../radioAnswers}} {{#if (eq pregunta
                                    ../idSubspecification )}} {{#if (eq respuesta '1' )}}checked {{/if}}{{/if}}
                                    {{/each}}>
                                <label for="{{idSubspecification}}bueno">Bueno</label>
                            </div>
                            <div class="col malo">
                                <input type="radio" name="{{idSubspecification}}" id="{{idSubspecification}}malo"
                                    autocomplete="off" value="2" {{#each ../../radioAnswers}} {{#if (eq pregunta
                                    ../idSubspecification )}} {{#if (eq respuesta '2' )}}checked {{/if}}{{/if}}
                                    {{/each}}>
                                <label for="{{idSubspecification}}malo">Malo</label>
                            </div>
                            <div class="col no_aplica">
                                <input type="radio" name="{{idSubspecification}}" id="{{idSubspecification}}no_aplica"
                                    autocomplete="off" value="3" {{#each ../../radioAnswers}} {{#if (eq pregunta
                                    ../idSubspecification )}} {{#if (eq respuesta '3' )}}checked {{/if}}{{/if}}
                                    {{/each}}>
                                <label for="{{idSubspecification}}no_aplica">No Aplica</label>
                            </div>
                        </div>
                    </div>
                    {{/if}}
                    {{/each}}
                </div>
            </div>
            {{/each}}
            <div class="final">
                <div class="header">
                    <span class="title">FINALIZACIÓN</span>
                </div>
                <div class="description">
                    <div class="preguntas">
                        <span class="title">Nombre completo y firma del inspecctor</span>
                        <div class="row-fin ">
                            <input type="text" name="inspector" id="inspector" placeholder="Nombre completo">
                        </div>
                        <div class="row-fin">
                            <button type="submit">Inspeccion</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </form>
</section>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>

<script>
    /*$(document).ready(function () {
        $('#encuestaForm').submit(function (e) {
            var unansweredQuestions = [];
            const alreadyChecked = new Set();
            $('input[type="radio"]').each(function () {
                const name = $(this).attr('name');
                if (!alreadyChecked.has(name)) {
                    alreadyChecked.add(name);
                    if ($(`input[name="${name}"]:checked`).length === 0) {
                        const pregunta = $(this).closest('.preguntas').find('h5').text().trim();
                        unansweredQuestions.push("Pregunta " + name + ": " + pregunta);
                    }
                }
            });

            if (unansweredQuestions.length > 0) {
                e.preventDefault();
                var message = "Por favor, responde las siguientes preguntas:\n" + unansweredQuestions.join("\n");
                alert(message);
            }
        });
    });

    const firmaForm = document.getElementById('encuestaForm');

    document.addEventListener("DOMContentLoaded", function () {
        try {
            document.getElementById('inputFirma').addEventListener('change', function () {
                var inputFirma = document.getElementById('inputFirma');
                var firmaPrevia = document.getElementById('firmaPrevia');

                if (inputFirma.files.length > 0) {
                    var selectedImage = inputFirma.files[0];
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        var imageData = e.target.result;
                        firmaPrevia.src = imageData;
                        firmaPrevia.style.display = 'block';

                        $('#modalFirma').modal('hide');
                    };

                    reader.readAsDataURL(selectedImage);
                }
            });
        } catch (error) {
            console.error("Se produjo un error:", error);
        }


        try {
            var canvas = document.getElementById('signature');
            var signaturePad = new SignaturePad(canvas);


            document.getElementById('guardarFirma').addEventListener('click', function () {
                var signatureData = signaturePad.toDataURL(); // Obtiene la firm como una imagen en formato base64

                // Actualiza la fuente de la imagen con la firm previa
                var firmaPrevia = document.getElementById('firmaPrevia');
                firmaPrevia.src = signatureData;
                firmaPrevia.style.display = 'block';

                //const firmImagen = canvas.toDataURL('image/png');
                const firmaInput = document.createElement('input');
                firmaInput.type = 'hidden';
                firmaInput.name = 'signature';
                firmaInput.value = signatureData;
                firmaForm.appendChild(firmaInput);

                $('#dibujarFirmaModal').modal('hide');
            });

            document.getElementById('borrarFirma').addEventListener('click', function () {
                signaturePad.clear();
                var firmaPrevia = document.getElementById('firmaPrevia');
                firmaPrevia.src = '';
                firmaPrevia.style.display = 'none';
            });
        } catch (error) {
            console.error("Se produjo un error:", error);
        }
    });*/




</script>